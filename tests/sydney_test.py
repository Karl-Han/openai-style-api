from clients.sydney import SydneyClient

import pytest
from aiohttp import ClientSession
import os
from loguru import logger

cookies = """
MC1=GUID=a333f0d04f1f435d96f28b46d63b03b4&HASH=a333&LV=202303&V=4&LU=1679400980551; at_check=true; MUID=1CADEAA4DBC16DE135F2F87FDAEF6C07; _mkto_trk=id:157-GQE-382&token:_mch-microsoft.com-1683885388817-44659; AMCVS_EA76ADE95776D2EC7F000101%40AdobeOrg=1; nlid=4a7cecc|df90292; _ga=GA1.1.1879828097.1689651032; _ga_JN5MSL685T=GS1.1.1689651032.1.0.1689651037.55.0.0; MUIDB=1CADEAA4DBC16DE135F2F87FDAEF6C07; USRLOC=HS=1; SRCHD=AF=NOFORM; SRCHUID=V=2&GUID=C5EB75827C784DA09BC339431D246FD7&dmnchg=1; CSRFCookie=2ab8449e-0330-4755-a578-41d7d4a3a1ab; SRCHUSR=DOB=20231128&POEX=W; _EDGE_S=SID=39C984F2117D606627A3972510A4617F; ANON=A=6C7DF072D6FB96CF5C21544BFFFFFFFF&E=1d08&W=2; NAP=V=1.9&E=1cc1&C=Kv-KEM2MjtduzM9XODHoKAIldAI9w-HiVO1wwF5mRYTBeKXKP_dHAw&W=2; PPLState=1; KievRPSSecAuth=FABSBBRaTOJILtFsMkpLVWSG6AN6C/svRwNmAAAEgAAACMpHReGzXqf2EATRmMukJTbexb9d6OVu7w+Qen8YIwwEf2ljKLLmWTEhW5fL8/tNoZyKBQcGhgnrxsRFWDvQD3tRHoAEzEgOG/6KK+KLxADn5Kvd2bk85+z688UNQSQLTXukXb1JB/q4ulZ61aEcAkep2ZuIhQWnU0dKgx7xHme91WrXYVxdmyNcm5NFbc41+8LV5Cw3QEdbu0lFevbBuXoehtzZIDAp0Flw5OQeqf1sYF7SiPI9qx+Brw/gM55pQu7Q4rDS3xpdvEVhhBPyqpRXN6T73fqZ9Ww22i10clDfZQUYrS7KOeGUxXVHq1VNQgwEWnnXLRnv8V5b8q2xaxnFDDtq4vg5fBL+86ONgPUpyIrvpQFDtNZib+Wd+jw5UikpbSKPONTa9W2S1PHbdmpi+YgVCo3rpXY23pnhtrww8ubTxE7QDRILj6T5QK3OqRRm/Wsyk25N56fz0u9zVI1bpi7IJ3WMvblA3Pv2mzI0zSA/lx98bJn4gTNgE1sjRKS25qJR9VX117NwWBe5LSXi38AXOe5PSonkc0oQDG1ksD3arPUK3vojxMymPI5kWT7JWN9V7aEu2Pw78R9mQ9p9GJYk4TCMZpAVfIzZrN+TGSMqlHbf1uYE9ehq+GZ4h903TRuSeQNEqwx76qnT7SXil7PSz4Q7mSKm2rP3fHHYM8phMJNUnDlIia/T28PndWx9KbgOwB2KrJ53P8U/HZ2ZSEL/S2YvwhGA9bBKa+1BksW86n16N/t63kWh3koSbHXDtbEbPRZKnKLVu/3lUEKvDsgNTrG3RWBlgl8PubbbMjkfgUcgVNV76PCw/UXVqzpBDnDyY3OwDUuCjVEoAK3FnUdmRrrn8fv63yyprW032aM/1j3PFzmYCIwK6+5whM55Fl5x36PwCZCndC1zdx6iebBUm1ZoWT9XmvMK6bhXsKpQHhQQdYSLQ+b2ByahUfIORPFcRrOyL0jrjAPu3OzEaCwWoRuA2YSWOFhbrXdZ+iTEe61cxXqb00OzBMf7MLfGiJNTglz6gMT9I6UNZvFg3GRAbOVepiDPvs2C5zWgJccAZ0KMq7pqz+1KvJXd3q7K9hVrYSjgx2ctYBZT7PFmSLTUo/rLCzfFvp1a+GOePOAaPY134MLrQ0d2opmjycyTm5CGOxePMCLZSqGYRygWlU6kIEiImq2zIz295rg6fp6gRmnFGjgyg6Z/XeU3xEQKo5hpvcuYtK3vvMZTs7FLmI5rI/YBVyN1MgRlPra2JM13yEvexl/Y17Lvd4wg8vp+L4VmW1xBq/qXSOpbSuCA204c2eDsRjJbJfB4WYSO9kMJdMWhp7aduVBeAafbh+XrAYEwXS7AOMynhulnc25MCLCyYS+uixcbhN/lHa+KVQVMqL2CcaqKKhQAYJkLYV8a/d09xQuKfVAtE4MQX1g=; WLS=C=b662b696efce7462&N=mh; _RwBf=mta=0&rc=0&rb=0&gb=0&rg=0&pc=0&mtu=0&rbb=0.0&g=0&cid=&clo=0&v=1&l=2023-11-27T08:00:00.0000000Z&lft=0001-01-01T00:00:00.0000000&aof=0&o=0&p=MSAAUTOENROLL&c=MR000T&t=8812&s=2023-11-28T07:00:57.5519013+00:00&ts=2023-11-28T07:00:58.0750901+00:00&rwred=0&wls=2&wlb=0&lka=0&lkt=0&aad=0&TH=&e=ONzO5vY6TJZO2_TRaulc_ofApa2qlTJWDDRqMoHL7xo-kjY8fKHNane6e6lyNl5qTjtgVmRTmI9HtQmhP1pluazvyZk1ilKNOtiR0t5QIKo; _Rwho=u=d; _SS=SID=1670784759976E893B246B8C584E6FEF&R=0&RB=0&GB=0&RG=0&RP=0; _Rwho=u=d; fptctx2=H3ihr9e92IdW6yd1ZgQ9SyoufAf2k3o4JywpA2nh2nMeKormghhIDx5%252fpHniMDKSgEO6txrStcLTZfLKhMg964W1dlA%252f%252bTkcWdrqshFPHZ4wTeQpxHXjxmDEjBI6hrVN8u%252bzGevdcsh1pCOKSNOreXyCkVDSEOaNbMtpRUnvBdWCmjA04LrxFRupqHEnah09W0PcXEKNQUuZGHG7UCuSdHtpwS5CWBbr2%252bk1RX9g5ds%252bKyHm1W2zUVOaJ7l4Z6%252fIMHP1iifouvLbgArVMm2YFbYDN18T0De4Kw1OPioMV%252bc8wGfZ%252fqBG6NuyvNOOXzQ6UY81c74uI%252bl8H3sIf6eeRA%253d%253d; AMCV_EA76ADE95776D2EC7F000101%40AdobeOrg=1585540135%7CMCIDTS%7C19703%7CMCMID%7C20503854897158988103846552975799399602%7CMCAAMLH-1702888452%7C11%7CMCAAMB-1702888452%7C6G1ynYcLPuiQxYZrsz_pkqfLG9yMXBpb2zX5dvJdYQJzPXImdj0y%7CMCOPTOUT-1702290852s%7CNONE%7CMCAID%7CNONE%7CMCSYNCSOP%7C411-19710%7CvVersion%7C4.4.0%7CMCCIDH%7C1146014828; _uetvid=c91b8cb0f13f11ed823dadd350bbbb5d; _clck=14zt6el%7C2%7Cfhg%7C1%7C1227; mbox=PC#0e1a019fa4224b7a921ecedda2dc181b.32_0#1736472845|session#fcc59a7aac704f0cbf7bbee6786bac9e#1702288007; market=CN; SRCHHPGUSR=SRCHLANG=zh-Hans&PV=13.3.1&BRW=XW&BRH=T&CW=2191&CH=1048&SCW=2176&SCH=1048&DPR=1.0&UTC=480&DM=0&PRVCW=1996&PRVCH=1048&CIBV=1.1418.9-suno&cdxtone=Balanced&cdxtoneopts=galileo,saharagenconv5; CSRFCookie=2eabe7a6-95c2-4766-a866-c97f63b6bb83; SRCHUSR=DOB=20231128&POEX=W; _EDGE_S=SID=135203949C006C833E7817819DD96D61; ANON=A=D655DC298B2EDB3681F8124DFFFFFFFF&E=1d28&W=3; NAP=V=1.9&E=1cce&C=rZlN-ezCj1DwvewgY9GlkXMwx-IcvM40XQaFn0stJq0Wo1gYcvsCzg&W=3; PPLState=1; KievRPSSecAuth=FAByBBRaTOJILtFsMkpLVWSG6AN6C/svRwNmAAAEgAAACLfyW17jW+A/MARQlgZ7fNArm1QU+TNJvfE7Wk2zCBL2YGVemw/GqQ+UsVGDN70cLezQSIRQqkstzsQKu7R+5KvFfGHbZlNqKXZqb0t0EvYWOW/Ey4/MMYlPctIf44efUGNERfhj/E1YLBAHwuN7SAKVFCm1A6piPRjdgqAAOiLAORQaCC653IGveH9+sjhwpoxBkiNZOfQOgpguF6gSIYPgKbUeT3oBkcFPDNQPsJnc6YYKa+iM39Bfni8CMYPPY+q6qfHldo/RfbdyxhXnjJFbKEMQx7C9J0EkRxV0z7vz1IfEi3kR7DR4v3dVW14gd0njnI6ODvej1OJyIC/2qcCKE5xz46FUet66Xzlu5mAQ5gxkgaUzC3OCzi2xiuPs7BtssXvOn+YCwGPUX7B8CfLA+0YQ359qa+gsBrmVwoLAhSBL7YswYJ7gCcS9QY4NoAx6oAPKcGfY7FoeBCj5PngfoyuYC+xdxFzX6Pi2x7pd5L/Rw9XhU1LNiLicbIU9jgit+AOO6esqFVBmNUu8E41qjnpjWBL+PS/kEqFw4d7i/3kmT+sTuO/5n8pf5d2mTzzO6w04fRebNsVs/OHsSenikea6obipWEktgu5Q4PfLG0XniZ4SC2YZoYfn0Ui7g8e3KsY6yiaGkxiRGv+qhuaFNXVhlHZRQg+3kcY8Lg2GIzlDWaUabKDP6lMi62Fzs7SvgDfT5JrMooPOZnAqE2Va2yH327heWe522FwejW6/fibO7b3FqBBp3sBSG4KomHPOU0fxst5bHDVL3FRQuLghl0YmDaK7bXnYRs82lFwG/khYIVwMqvPRQWDh+OiML+hfJDHFVjB2iLuKvO3yfjjzZpuag8+HioQzNf082+VO1k3oHy3MXRseuW+XUFphSHEJwTTOyODAtaqzsGf1h5CamBNJ7p4gqO6F+bbaum9OyypBI/aHSORpi2sRkM/DFOt5MFDBEwoJTAbwESp/X4m8m1glhjmXjvCaEuAIlpprXeWg+LcCJH065GyWV1sbDqLiAwpT89/+d7k1BdVrzpcQoLc/mQYYFHIQ1udutbNGHD51kfuiksb/lUlsWSmBAnkVwjq9CE/je4K5pTYxcdNQNPfDTvgg+sxcKoQEJ6EaH50ck7hJKLomsOJj0J9ssBb2EncQzjTA14v9uDsC3VXR8kENOXD4dKN/9TYz4E/oojVR36kPzGDeLA0x0epvVYcmuSBuded9K8VTgur2/kz0jJA+OD068c82zqFwhsMEENBnRG7GT+qC1jCAVG8RgZwdNtfQLJd8CpiiiaiIwgDKoydl7IRHins1UW5zMSw/j/qv8N5Lgc+jYicaALqnhv+Tx/1ADi+/MxvCUfA816jyJf4ZwZJhBNhHdwmRep/Uxv7JmTlG3BAHzprwIvwsYU9+p9Qbng38bO/EF7u54PjQnJIgg9qGRzTtFADmtX3P/hNg4y6P0WKBhSoVtw52LQ==; _U=1ZTU6YJDFgMNCgvA3mcW5-rHtoU7giV4bj99PvueTR0JS88CtyvZmP05H5jIuP6B3GofHM6x8gyGNkk5rf3JutAB1kZ7lFSXSlsgHVdYM4nOqrioE4M7yHWit_rW0OpK7DufLne1XJyWJj_Zagx0PxuadcYyj3xGR49Ky0Pt43mA4ex7Px4nBdydWwtPIsI6JEzdqAcvwyVWWRSPE5tWY7Q; WLS=C=1c2bae6e0ca9eec0&N=minghui; WLID=ExKxHWGUnmgDBFsW3u3VPp2ogHBTvVktGdfD2TQXV9GIyghIRu27iB/PUZqjbL8KGRhGNsl1STqbn3FAHUaAL40kMq/PUmMoW6g/yFjxvYc=; SnrOvr=X=rebateson; _SS=SID=1670784759976E893B246B8C584E6FEF&R=5151&RB=5151&GB=0&RG=0&RP=5151; _RwBf=mta=0&rc=5151&rb=5151&gb=0&rg=0&pc=5151&mtu=0&rbb=0.0&g=0&cid=&clo=0&v=10&l=2024-01-29T08:00:00.0000000Z&lft=0001-01-01T00:00:00.0000000&aof=0&o=0&p=bingcopilotwaitlist&c=MY00IA&t=220&s=2023-02-25T08:08:17.9784942+00:00&ts=2024-01-30T02:02:54.4579117+00:00&rwred=0&wls=2&wlb=0&lka=0&lkt=0&aad=0&TH=&e=imWBu0hNlJPKvXDCygV52V8NpcTNmBIWlT8rKjL9vYeLaHngfkhUS4MCzVEbyvn7kuLqG_uCHmyyOo-_1q0ayg&wle=0&ccp=0&ard=0001-01-01T00:00:00.0000000&rwdbt=0001-01-01T16:00:00.0000000-08:00&A=D655DC298B2EDB3681F8124DFFFFFFFF&r=1; SRCHHPGUSR=SRCHLANG=zh-Hans&PV=13.3.1&BRW=XW&BRH=T&CW=2191&CH=1048&SCW=2176&SCH=1183&DPR=1.0&UTC=480&DM=0&PRVCW=1996&PRVCH=1048&CIBV=1.1418.9-suno&cdxtone=Balanced&cdxtoneopts=galileo,saharagenconv5
"""
os.environ["BING_COOKIES"] = cookies.strip()
pytest_plugins = ("pytest_asyncio",)


@pytest.mark.asyncio
async def test_ask_precise() -> bool:
    expected_responses = [
        "Hello! This is Bing. How can I help you today? ðŸ˜Š",
        "Hello! How can I help you today? ðŸ˜Š",
        "Hello! How can I assist you today?",
    ]

    async with SydneyClient(style="precise") as sydney:
        logger.info("------------------+++++++1")
        response = await sydney.ask("Hello, Bing!")
        logger.info(response)
        logger.info("------------------+++++++2")

        async for response_token in sydney.ask_stream("Hello, Bing!"):
            logger.info(response_token)
    logger.info("------------------+++++++3")
    return True
